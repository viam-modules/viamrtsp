syntax = "proto3";

package viammodules.service.videostore.v1;

option go_package = "./videostore-api";

service videostoreService {
  rpc Save(SaveRequest) returns (SaveResponse);
  rpc Fetch(FetchRequest) returns (FetchResponse);
  rpc FetchStream(FetchStreamRequest) returns (stream FetchStreamResponse);
  rpc GetStorageState(GetStorageStateRequest) returns (GetStorageStateResponse);
}

message SaveRequest {
  string name = 1;
  string from = 2;
  string to = 3;
  string container = 4; // e.g., "mp4", "fmp4"
  string metadata = 5;
  bool async = 6;
  string request_id = 7;
}

message SaveResponse {
  string filename = 1;
  string request_id = 2;
}

message FetchRequest {
  string name = 1;
  string from = 2;
  string to = 3;
  string container = 4;
  string request_id = 5;
}

message FetchResponse {
  bytes video_data = 1;
  string request_id = 2;
}

  message FetchStreamRequest {
    string name = 1;
    string from = 2;
    string to = 3;
    string container = 4; // e.g., "mp4", "fmp4"
    string request_id = 5;
}

message FetchStreamResponse {
  bytes video_data = 1;
  string request_id = 2;
}

message GetStorageStateRequest {
  string name = 1;
  string request_id = 2;
}

message GetStorageStateResponse {
  StorageState state = 1;
  string request_id = 2;
}

message StorageState {
  int64 storage_used_bytes = 1;
  int64 total_duration_ms = 2;
  int32 video_count = 3;
  repeated VideoRange ranges = 4;
  int32 storage_limit_gb = 5;
  double device_storage_remaining_gb = 6;
  string storage_path = 7;
}

message VideoRange {
  string from = 1;
  string to = 2;
}
